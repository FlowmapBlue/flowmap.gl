!function(){var t={6445:function(t,e,o){"use strict";var n=o(6562),i=o(3020),s=o(6659),r=o(2846),a=o(9961),c=o(5721),l=o(6752),g=o(2943),u=o(7850),d=o(348),h=o(5601),f=o(4497),m=o(3114),w=o(365);const p={minZoom:0,maxZoom:16,radius:40,extent:512,nodeSize:64,makeClusterName:(t,e)=>{},makeClusterId:t=>"{[".concat(t,"]}")};function F(t){const{index:e}=t;return null!=e}function v(t){const{id:e}=t;return null!=e}function L(t,e,o,n,i){return{x:t,y:e,zoom:1/0,id:o,parentId:-1,numPoints:n,weight:i}}function I(t,e,o,n){const i=[],{radius:s,extent:r}=n,a=s/(r*Math.pow(2,e));for(let c=0;c<t.length;c++){const n=t[c];if(n.zoom<=e)continue;n.zoom=e;const s=o.within(n.x,n.y,a);let r=n.weight||1,l=v(n)?n.numPoints:1,g=n.x*r,u=n.y*r;const d=(c<<5)+(e+1);for(const t of s){const n=o.points[t];if(n.zoom<=e)continue;n.zoom=e;const i=n.weight||1,s=n.numPoints||1;g+=n.x*i,u+=n.y*i,r+=i,l+=s,n.parentId=d}1===l?i.push(n):(n.parentId=d,i.push(L(g/r,u/r,d,l,r)))}return i}function b(t){return 360*(t-.5)}function y(t){const e=(180-360*t)*Math.PI/180;return 360*Math.atan(Math.exp(e))/Math.PI-90}function S(t){const e=Math.sin(t*Math.PI/180),o=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return o<0?0:o>1?1:o}function C(t){return t.x}function M(t){return t.y}function x(t){const{children:e}=t;return e&&e.length>0}function P(t){const{zoom:e}=t;return void 0!==e}function O(t){return t&&void 0!==t.origin&&void 0!==t.dest&&void 0!==t.count&&!!t.aggregate}var T;!function(t){t.ALL="ALL",t.INCOMING="INCOMING",t.OUTGOING="OUTGOING",t.BETWEEN="BETWEEN"}(T||(T={}));var D=o(6641);var E=o(7155),A=o(6718),Z=o(8936),B=o(578),N=o(7782),z=o(7154),k=o(1259),G=o(6918),_=o(6315),Y=o(9992),j=o(3542),R=o(222),V=o(642),U=o(8158),H=o(6152),K=o(4752),$=o(6972),W=o(3294),J=o(5162),X=o(1343),q=o(7784),Q=o(2197),tt=o(7382),et=o(2498),ot=o(6586),nt=o(2486);const it="rgba(240,240,240,0.5)",st=[it,"#137CBD"],rt=[it,"#f6654e"],at=[it,"#00a9cc"],ct=[255,255,255,255];function lt(t,e){const o=(0,ot.ZP)(t);if(!o)return console.warn("Invalid color: ",t),"rgba(255, 255, 255, ".concat(e,")");const n=o.rgb();return"rgba(".concat(n.r,", ").concat(n.g,", ").concat(n.b,", ").concat(e,")")}function gt(t){const e=(0,ot.ZP)(t);if(!e)return console.warn("Invalid color: ",t),ct;const o=e.rgb();return[Math.floor(o.r),Math.floor(o.g),Math.floor(o.b),(n=e.opacity,Math.round(255*n))];var n}function ut(t,e){return t?gt(t):"string"===typeof e?gt(e):e}const dt=t=>t[t.length-1];var ht;!function(t){t.primary="#162d3c"}(ht||(ht={}));const ft=t=>(0,q.Z)(0,21).map((e=>t(e/20))).reverse(),mt="rgba(240,240,240,0.5)",wt=[mt,ht.primary],pt=["#d1eeea","#a8dbd9","#85c4c9","#68abb8","#4f90a6","#3b738f","#2a5674"],Ft=pt,vt={Blues:dt(E.r),BluGrn:["#c4e6c3","#96d2a4","#6dbc90","#4da284","#36877a","#266b6e","#1d4f60"],BluYl:["#f7feae","#b7e6a5","#7ccba2","#46aea0","#089099","#00718b","#045275"],BrwnYl:["#ede5cf","#e0c2a2","#d39c83","#c1766f","#a65461","#813753","#541f3f"],BuGn:dt(A.r),BuPu:dt(Z.r),Burg:["#ffc6c4","#f4a3a8","#e38191","#cc607d","#ad466c","#8b3058","#672044"],BurgYl:["#fbe6c5","#f5ba98","#ee8a82","#dc7176","#c8586c","#9c3f5d","#70284a"],Cool:ft(B.H7),DarkMint:["#d2fbd4","#a5dbc2","#7bbcb0","#559c9e","#3a7c89","#235d72","#123f5a"],Emrld:["#d3f2a3","#97e196","#6cc08b","#4c9b82","#217a79","#105965","#074050"],GnBu:dt(N.r),Grayish:wt,Greens:dt(z.r),Greys:dt(k.r),Inferno:ft(G.yy),Magenta:["#f3cbd3","#eaa9bd","#dd88ac","#ca699d","#b14d8e","#91357d","#6c2167"],Magma:ft(G.uX),Mint:["#e4f1e1","#b4d9cc","#89c0b6","#63a6a0","#448c8a","#287274","#0d585f"],Oranges:dt(_.r),OrRd:dt(Y.r),OrYel:["#ecda9a","#efc47e","#f3ad6a","#f7945d","#f97b57","#f66356","#ee4d5a"],Peach:["#fde0c5","#facba6","#f8b58b","#f59e72","#f2855d","#ef6a4c","#eb4a40"],Plasma:ft(G.zD),PinkYl:["#fef6b5","#ffdd9a","#ffc285","#ffa679","#fa8a76","#f16d7a","#e15383"],PuBu:dt(j.r),PuBuGn:dt(R.r),PuRd:dt(V.r),Purp:["#f3e0f7","#e4c7f1","#d1afe8","#b998dd","#9f82ce","#826dba","#63589f"],Purples:dt(U.r),PurpOr:["#f9ddda","#f2b9c4","#e597b9","#ce78b3","#ad5fad","#834ba0","#573b88"],RdPu:dt(H.r),RedOr:["#f6d2a9","#f5b78e","#f19c7c","#ea8171","#dd686c","#ca5268","#b13f64"],Reds:dt(K.r),Sunset:["#f3e79b","#fac484","#f8a07e","#eb7f86","#ce6693","#a059a0","#5c53a5"],SunsetDark:["#fcde9c","#faa476","#f0746e","#e34f6f","#dc3977","#b9257a","#7c1d6f"],Teal:pt,TealGrn:["#b0f2bc","#89e8ac","#67dba5","#4cc8a3","#38b2a3","#2c98a0","#257d98"],Viridis:ft(G.ZP),Warm:ft(B.s7),YlGn:dt($.r),YlGnBu:dt(W.r),YlOrBr:dt(J.r),YlOrRd:dt(X.r)},Lt=(Object.keys(vt),{negative:{flows:{scheme:[mt,"#17a5be"]}},positive:{flows:{scheme:[mt,"#f52020"]}},locationAreas:{outline:"rgba(92,112,128,0.5)",normal:"rgba(220,220,220,0.5)"},outlineColor:"rgb(230,233,237)"});function It(t,e,o,n,i,s,r){if(t)return Lt;let a=e&&vt[e]||Ft;o&&(a=a.slice().reverse());{const t=(0,q.Z)(0,Math.max(10,a.length)),e=t.length-1,r=(0,Q.ZP)((0,tt.hD)(a)).domain([0,e]);if(n&&0!==s){const n=(0,u.ZP)().exponent(1.5).domain([e,0]).range([0,2*s/100]);a=t.map(((t,e)=>{const s=r(e),a=n(e);if(null==s||null==a)return"#000";const c=(0,nt.Uc)(s);return c.l=o?c.l-c.l*a:c.l+(100-c.l)*a,c.c=c.c-c.c*(a/4),i&&(c.opacity=c.opacity*(1-a)),c.toString()}))}else a=t.map(((t,e)=>r(e)))}return{darkMode:o,flows:{scheme:a},locationCircles:{outgoing:o?"#000":"#fff"},outlineColor:o?"#000":"rgba(255, 255, 255, 0.5)"}}function bt(t,e,o){const n=(0,Q.UN)(function(t){const e=et.Z,o=t.length;let n,i,s=new Array(o),r=new Array(o),a=new Array(o),c=new Array(o);for(n=0;n<o;++n)i=(0,ot.B8)(t[n]),s[n]=i.r||0,r[n]=i.g||0,a[n]=i.b||0,c[n]=i.opacity||0;return s=e(s),r=e(r),a=e(a),c=e(c),function(t){return i.r=s(t),i.g=r(t),i.b=a(t),i.opacity=c(t),i+""}}(e)).exponent(o?.5:1/3).domain(t);return t=>gt(n(t))}function yt(t){return void 0!==t.positive}function St(t,e){const o=t&&t.normal||"rgba(220,220,220,0.5)",n=(0,nt.Uc)(o),i=gt(o);return{normal:i,connected:ut(t&&t.connected,i),highlighted:ut(t&&t.highlighted,lt(n[e?"brighter":"darker"](1).toString(),.5)),selected:ut(t&&t.selected,lt(n[e?"brighter":"darker"](2).toString(),.8)),outline:ut(t&&t.outline,gt(n[e?"brighter":"darker"](4).toString()))}}function Ct(t,e,o){var n,i,s;const r=t&&t.flows&&t.flows.scheme||e,a=(0,nt.Uc)(r[r.length-1]),c=ut(t&&t.flows&&t.flows.highlighted,gt(a[o?"brighter":"darker"](.7).toString())),l=ut(null===(n=null===t||void 0===t?void 0:t.locationCircles)||void 0===n?void 0:n.empty,o?"#000":"#fff");return{flows:{scheme:r,highlighted:c},locationCircles:{inner:ut(t&&t.locationCircles&&t.locationCircles.inner,a.toString()),outgoing:ut(t&&t.locationCircles&&t.locationCircles.outgoing,o?"#000":"#fff"),incoming:ut(t&&t.locationCircles&&t.locationCircles.incoming,a[o?"brighter":"darker"](1.25).toString()),highlighted:ut(t&&t.locationCircles&&t.locationCircles.highlighted,c),empty:l,outlineEmptyMix:null!==(s=null===(i=null===t||void 0===t?void 0:t.locationCircles)||void 0===i?void 0:i.outlineEmptyMix)&&void 0!==s?s:.4}}}function Mt(t){const e=!(!t||!t.darkMode);return{darkMode:e,locationAreas:St(t&&t.locationAreas,e),outlineColor:gt(t&&t.outlineColor||"#fff"),dimmedOpacity:t&&null!=t.dimmedOpacity?t.dimmedOpacity:.4}}var xt=It;class Pt{constructor(t){this.getLocationId=t=>P(t)?t.id:this.accessors.getLocationId(t),this.getLocationName=t=>{var e;return null!==(e=P(t)&&x(t)?t.name:void 0)&&void 0!==e?e:this.getLocationId(t)},this.getLocationCentroid=t=>P(t)?t.centroid:this.accessors.getLocationCentroid(t),this.getFlowOriginId=t=>O(t)?t.origin:this.accessors.getFlowOriginId(t),this.getFlowDestId=t=>O(t)?t.dest:this.accessors.getFlowDestId(t),this.getFlowMagnitude=t=>O(t)?t.count:this.accessors.getFlowMagnitude(t),this.getFlowTime=t=>{const{getFlowTime:e}=this.accessors;return e?e(t):void 0},this.accessors=t}setAccessors(t){this.accessors=t}getFlowmapDataAccessors(){return this.accessors}}var Ot=o(7212),Tt=o(9361),Dt=o(1606),Et=o(6939),At=o(3345),Zt=o(2676),Bt=o(8658);(0,Ot.Z1)("%Y-%m-%d"),(0,Ot.Z1)("%Y-%m-%d %H:%M"),(0,Ot.Z1)("%Y-%m-%d %H:%M:%S"),(0,Ot.Z1)("%Y"),(0,Ot.Z1)("%Y-%m");var Nt;!function(t){t.SECOND="SECOND",t.MINUTE="MINUTE",t.HOUR="HOUR",t.DAY="DAY",t.MONTH="MONTH",t.YEAR="YEAR"}(Nt||(Nt={}));(0,Ot.i$)(".%L");const zt=(0,Ot.i$)(":%S"),kt=(0,Ot.i$)("%I:%M"),Gt=(0,Ot.i$)("%I %p"),_t=(0,Ot.i$)("%a %d"),Yt=((0,Ot.i$)("%b %d"),(0,Ot.i$)("%b")),jt=(0,Ot.i$)("%Y");const Rt=[{order:0,key:Nt.SECOND,interval:Tt.Z,format:zt,formatFull:(0,Ot.i$)("%Y-%m-%d %H:%M:%S")},{order:1,key:Nt.MINUTE,interval:Dt.Z,format:kt,formatFull:(0,Ot.i$)("%Y-%m-%d %H:%M")},{order:2,key:Nt.HOUR,interval:Et.Z,format:Gt,formatFull:(0,Ot.i$)("%a %d %b %Y, %I %p")},{order:3,key:Nt.DAY,interval:At.Z,format:_t,formatFull:(0,Ot.i$)("%a %d %b %Y")},{order:4,key:Nt.MONTH,interval:Zt.Z,format:Yt,formatFull:(0,Ot.i$)("%b %Y")},{order:5,key:Nt.YEAR,interval:Bt.Z,format:jt,formatFull:(0,Ot.i$)("%Y")}];function Vt(t){return Rt.find((e=>e.key===t))}class Ut{constructor(t){this.getFetchedFlows=(t,e)=>e.flows,this.getFetchedLocations=(t,e)=>e.locations,this.getMaxTopFlowsDisplayNum=(t,e)=>t.settingsState.maxTopFlowsDisplayNum,this.getSelectedLocations=(t,e)=>t.filterState.selectedLocations,this.getLocationFilterMode=(t,e)=>t.filterState.locationFilterMode,this.getClusteringEnabled=(t,e)=>t.settingsState.clusteringEnabled,this.getLocationTotalsEnabled=(t,e)=>t.settingsState.locationTotalsEnabled,this.getZoom=(t,e)=>t.viewport.zoom,this.getViewport=(t,e)=>t.viewport,this.getSelectedTimeRange=(t,e)=>t.filterState.selectedTimeRange,this.getColorSchemeKey=(t,e)=>t.settingsState.colorScheme,this.getDarkMode=(t,e)=>t.settingsState.darkMode,this.getFadeEnabled=(t,e)=>t.settingsState.fadeEnabled,this.getFadeOpacityEnabled=(t,e)=>t.settingsState.fadeOpacityEnabled,this.getFadeAmount=(t,e)=>t.settingsState.fadeAmount,this.getAnimate=(t,e)=>t.settingsState.animationEnabled,this.getInvalidLocationIds=(0,h.P1)(this.getFetchedLocations,(t=>{if(!t)return;const e=[];for(const o of t){const t=this.accessors.getLocationId(o),[n,i]=this.accessors.getLocationCentroid(o)||[NaN,NaN];-90<=i&&i<=90&&-180<=n&&n<=180||e.push(t)}return e.length>0?e:void 0})),this.getLocations=(0,h.P1)(this.getFetchedLocations,this.getInvalidLocationIds,((t,e)=>{if(!t)return;if(!e||0===e.length)return t;const o=new Set(e);return t.filter((t=>!o.has(this.accessors.getLocationId(t))))})),this.getLocationIds=(0,h.P1)(this.getLocations,(t=>t?new Set(t.map(this.accessors.getLocationId)):void 0)),this.getSelectedLocationsSet=(0,h.P1)(this.getSelectedLocations,(t=>t&&t.length>0?new Set(t):void 0)),this.getSortedFlowsForKnownLocations=(0,h.P1)(this.getFetchedFlows,this.getLocationIds,((t,e)=>{if(e&&t)return t.filter((t=>e.has(this.accessors.getFlowOriginId(t))&&e.has(this.accessors.getFlowDestId(t)))).sort(((t,e)=>(0,s.Z)(Math.abs(this.accessors.getFlowMagnitude(t)),Math.abs(this.accessors.getFlowMagnitude(e)))))})),this.getActualTimeExtent=(0,h.P1)(this.getSortedFlowsForKnownLocations,(t=>{if(!t)return;let e=null,o=null;for(const n of t){const t=this.accessors.getFlowTime(n);t&&((null==e||e>t)&&(e=t),(null==o||o<t)&&(o=t))}return e&&o?[e,o]:void 0})),this.getTimeGranularityKey=(0,h.P1)(this.getSortedFlowsForKnownLocations,this.getActualTimeExtent,((t,e)=>{if(!t||!e)return;const o=(0,r.Z)(t,(t=>{const e=this.accessors.getFlowTime(t);return e?function(t){let e;for(const o of Rt){const{interval:n}=o;if(n(t)<t)return e||o;e=o}return Rt[Rt.length-1]}(e).order:null}));if(null==o)return;const n=(i=o,Rt.find((t=>t.order===i)));var i;return n?n.key:void 0})),this.getTimeExtent=(0,h.P1)(this.getActualTimeExtent,this.getTimeGranularityKey,((t,e)=>{const o=e?Vt(e):void 0;if(!t||!(null===o||void 0===o?void 0:o.interval))return;const{interval:n}=o;return[t[0],n.offset(n.floor(t[1]),1)]})),this.getSortedFlowsForKnownLocationsFilteredByTime=(0,h.P1)(this.getSortedFlowsForKnownLocations,this.getTimeExtent,this.getSelectedTimeRange,((t,e,o)=>{if(t)return!e||!o||e[0]===o[0]&&e[1]===o[1]?t:t.filter((t=>{const e=this.accessors.getFlowTime(t);return e&&o[0]<=e&&e<o[1]}))})),this.getLocationsHavingFlows=(0,h.P1)(this.getSortedFlowsForKnownLocations,this.getLocations,((t,e)=>{if(!e||!t)return e;const o=new Set;for(const n of t)o.add(this.accessors.getFlowOriginId(n)),o.add(this.accessors.getFlowDestId(n));return e.filter((t=>o.has(this.accessors.getLocationId(t))))})),this.getLocationsById=(0,h.P1)(this.getLocationsHavingFlows,(t=>{if(t)return(0,l.b1)().key((t=>this.accessors.getLocationId(t))).rollup((t=>{let[e]=t;return e})).map(t)})),this.getClusterIndex=(0,h.P1)(this.getLocationsHavingFlows,this.getLocationsById,this.getSortedFlowsForKnownLocations,((t,e,o)=>{if(!t||!e||!o)return;const n=function(t,e){let{getFlowOriginId:o,getFlowDestId:n,getFlowMagnitude:i}=e;const s={incoming:new Map,outgoing:new Map};for(const r of t){const t=o(r),e=n(r),a=i(r);s.incoming.set(e,(s.incoming.get(e)||0)+a),s.outgoing.set(t,(s.outgoing.get(t)||0)+a)}return t=>Math.max(Math.abs(s.incoming.get(t)||0),Math.abs(s.outgoing.get(t)||0))}(o,this.accessors.getFlowmapDataAccessors()),i=function(t,e,o,n){const{getLocationCentroid:i,getLocationId:s}=e,r=Object.assign(Object.assign({},p),n),{minZoom:a,maxZoom:c,nodeSize:l,makeClusterName:g,makeClusterId:u}=r,h=new Array(c+1);let f=new Array;for(let d=0;d<t.length;d++){const[e,n]=i(t[d]);f.push({x:(m=e,m/360+.5),y:S(n),weight:o(s(t[d])),zoom:1/0,index:d,parentId:-1})}var m;h[c+1]=new d.Z(f,C,M,l,Float32Array);for(let w=c;w>=a;w--)f=I(f,w,h[w+1],r),h[w]=new d.Z(f,C,M,l,Float32Array);if(0===h.length)return[];const L=h.map((t=>t.points.length)),x=L.indexOf(L[L.length-1]),P=Math.min(x,L.lastIndexOf(L[0])),O=new Array;for(let d=P;d<=x;d++){let e;const o=h[d];d<x&&(e=(0,w.jJ)(h[d+1].points,(e=>e.map((e=>e.id?u(e.id):s(t[e.index])))),(t=>t.parentId)));const n=[];for(const r of o.points){const{x:o,y:a,numPoints:c}=r;if(F(r)){const e=t[r.index];n.push({id:s(e),zoom:d,centroid:i(e)})}else if(v(r)){const{id:t}=r,i=e&&e.get(t);if(!i)throw new Error("Cluster ".concat(t," doesn't have children"));n.push({id:u(t),name:g(t,c),zoom:d,centroid:[b(o),y(a)],children:i})}}O.push({zoom:d,nodes:n})}return O}(t,this.accessors.getFlowmapDataAccessors(),n,{maxZoom:20}),r=function(t){const e=new Map,o=new Map,n=new Map;for(const{zoom:a,nodes:c}of t){e.set(a,c);for(const t of c)if(x(t))o.set(t.id,t);else{const{id:e}=t,o=n.get(e);(null==o||o>a)&&n.set(e,a)}}const[i,s]=(0,a.Z)(t,(t=>t.zoom));if(null==i||null==s)throw new Error("Could not determine minZoom or maxZoom");const r=new Map;for(const a of o.values()){const{zoom:t}=a;let e=r.get(t);e||(e=new Map,r.set(t,e)),l(a,(t=>{null===e||void 0===e||e.set(t,a)}))}function l(t,e){for(const n of t.children){const t=o.get(n);t?l(t,e):e(n)}}function g(t,e){const o=r.get(e);if(!o)return;const n=o.get(t);return n?n.id:void 0}return{availableZoomLevels:t.map((t=>+t.zoom)).sort(((t,e)=>(0,c.Z)(t,e))),getClusterNodesFor:t=>{if(void 0!==t)return e.get(t)},getClusterById:t=>o.get(t),getMinZoomForLocation:t=>n.get(t)||i,expandCluster:function(t){let e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:s;const n=[],i=(t,n)=>{if(e>t.zoom)for(const e of t.children){const t=o.get(e);t?i(t,n):n.push(e)}else n.push(t.id)};return i(t,n),n},findClusterFor:g,aggregateFlows:function(t,e,o){let{getFlowOriginId:n,getFlowDestId:i,getFlowMagnitude:r}=o,a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};if(e>s)return t;const c=[],l=new Map,u=(t,e)=>"".concat(t,":").concat(e),{flowCountsMapReduce:d={map:r,reduce:(t,e)=>(t||0)+e}}=a;for(const s of t){const t=n(s),o=i(s),r=g(t,e)||t,a=g(o,e)||o,h=u(r,a);if(r===t&&a===o)c.push(s);else{let t=l.get(h);t?t.count=d.reduce(t.count,d.map(s)):(t={origin:r,dest:a,count:d.map(s),aggregate:!0},c.push(t),l.set(h,t))}}return c}}}(i),{getLocationName:l,getLocationClusterName:g}=this.accessors.getFlowmapDataAccessors(),u=t=>{const o=e.get(t);return o?l?l(o):this.accessors.getLocationId(o)||t:'"'.concat(t,'"')};for(const a of i)for(const t of a.nodes)if(x(t)){const e=r.expandCluster(t);if(e.sort(((t,e)=>(0,s.Z)(n(t),n(e)))),g)t.name=g(e);else{const o=e[0],n=2===e.length?e[1]:void 0;t.name='"'.concat(u(o),'" and ').concat(n?'"'.concat(u(n),'"'):"".concat(e.length-1," others"))}}else t.name=u(t.id);return r})),this.getAvailableClusterZoomLevels=(0,h.P1)(this.getClusterIndex,this.getSelectedLocations,((t,e)=>{if(!t)return;let o=Number.POSITIVE_INFINITY,n=Number.NEGATIVE_INFINITY;const i=e=>{const i=t.getClusterById(e);if(i)n=Math.max(n,i.zoom),o=Math.min(o,i.zoom);else{const o=t.getMinZoomForLocation(e);n=Math.max(n,o)}};if(e)for(const s of e)i(s);return t.availableZoomLevels.filter((t=>n<=t&&t<=o))})),this._getClusterZoom=(0,h.P1)(this.getClusterIndex,this.getZoom,this.getAvailableClusterZoomLevels,((t,e,o)=>{if(!t)return;if(!o)return;return function(t,e){if(!t.length)throw new Error("No available zoom levels");return t[Math.min((0,D.Nw)(t,Math.floor(e)),t.length-1)]}(o,e)})),this.getClusterZoom=(t,e)=>{const{settingsState:o}=t;if(o.clusteringEnabled)return o.clusteringAuto||null==o.clusteringLevel?this._getClusterZoom(t,e):o.clusteringLevel},this.getLocationsForSearchBox=(0,h.P1)(this.getClusteringEnabled,this.getLocationsHavingFlows,this.getSelectedLocations,this.getClusterZoom,this.getClusterIndex,((t,e,o,n,i)=>{if(!e)return;let s=e;if(s&&i&&o){const t=[];for(const e of o){const o=i.getClusterById(e);o&&!s.find((t=>(P(t)?t.id:this.accessors.getLocationId(t))===e))&&t.push(o)}t.length>0&&(s=s.concat(t))}return s})),this.getDiffMode=(0,h.P1)(this.getFetchedFlows,(t=>!(!t||!t.find((t=>this.accessors.getFlowMagnitude(t)<0))))),this._getFlowmapColors=(0,h.P1)(this.getDiffMode,this.getColorSchemeKey,this.getDarkMode,this.getFadeEnabled,this.getFadeOpacityEnabled,this.getFadeAmount,this.getAnimate,xt),this.getFlowmapColorsRGBA=(0,h.P1)(this._getFlowmapColors,(t=>function(t){return void 0!==t.positive}(t)?function(t){const e=Mt(t);return Object.assign(Object.assign({},e),{positive:Ct(t&&t.positive,rt,e.darkMode),negative:Ct(t&&t.negative,at,e.darkMode)})}(t):function(t){const e=Mt(t);return Object.assign(Object.assign({},e),Ct(t,st,e.darkMode))}(t))),this.getUnknownLocations=(0,h.P1)(this.getLocationIds,this.getFetchedFlows,this.getSortedFlowsForKnownLocations,((t,e,o)=>{if(!t||!e)return;if(o&&e.length===o.length)return;const n=new Set;for(const i of e)t.has(this.accessors.getFlowOriginId(i))||n.add(this.accessors.getFlowOriginId(i)),t.has(this.accessors.getFlowDestId(i))||n.add(this.accessors.getFlowDestId(i));return n})),this.getSortedAggregatedFilteredFlows=(0,h.P1)(this.getClusterIndex,this.getClusteringEnabled,this.getSortedFlowsForKnownLocationsFilteredByTime,this.getClusterZoom,this.getTimeExtent,((t,e,o,n,i)=>{if(!o)return;let r;return r=e&&t&&null!=n?t.aggregateFlows(o,n,this.accessors.getFlowmapDataAccessors()):function(t,e){const o=(0,l.b1)().key(e.getFlowOriginId).key(e.getFlowDestId).rollup((t=>({aggregate:!0,origin:e.getFlowOriginId(t[0]),dest:e.getFlowDestId(t[0]),count:t.reduce(((t,o)=>{const n=e.getFlowMagnitude(o);return n&&!isNaN(n)&&isFinite(n)?t+n:t}),0)}))).entries(t),n=[];for(const{values:i}of o)for(const{value:t}of i)n.push(t);return n}(o,this.accessors.getFlowmapDataAccessors()),r.sort(((t,e)=>(0,s.Z)(Math.abs(this.accessors.getFlowMagnitude(t)),Math.abs(this.accessors.getFlowMagnitude(e))))),r})),this.getFlowMagnitudeExtent=(0,h.P1)(this.getSortedAggregatedFilteredFlows,this.getSelectedLocationsSet,this.getLocationFilterMode,((t,e,o)=>{if(!t)return;let n;for(const i of t)if(this.accessors.getFlowOriginId(i)!==this.accessors.getFlowDestId(i)&&this.isFlowInSelection(i,e,o)){const t=this.accessors.getFlowMagnitude(i);null==n?n=[t,t]:(t<n[0]&&(n[0]=t),t>n[1]&&(n[1]=t))}return n})),this.getExpandedSelectedLocationsSet=(0,h.P1)(this.getClusteringEnabled,this.getSelectedLocationsSet,this.getClusterIndex,((t,e,o)=>{if(!e||!o)return e;const n=new Set;for(const i of e){const t=o.getClusterById(i);if(t){const e=o.expandCluster(t);for(const t of e)n.add(t)}else n.add(i)}return n})),this.getTotalCountsByTime=(0,h.P1)(this.getSortedFlowsForKnownLocations,this.getTimeGranularityKey,this.getTimeExtent,this.getExpandedSelectedLocationsSet,this.getLocationFilterMode,((t,e,o,n,i)=>{const s=e?Vt(e):void 0;if(!t||!s||!o)return;const r=t.reduce(((t,e)=>{var o;if(this.isFlowInSelection(e,n,i)){const n=s.interval(this.accessors.getFlowTime(e)).getTime();t.set(n,(null!==(o=t.get(n))&&void 0!==o?o:0)+this.accessors.getFlowMagnitude(e))}return t}),new Map);return Array.from(r.entries()).map((t=>{let[e,o]=t;return{time:new Date(e),count:o}}))})),this.getMaxLocationCircleSize=(0,h.P1)(this.getLocationTotalsEnabled,(t=>t?17:1)),this.getViewportBoundingBox=(0,h.P1)(this.getViewport,this.getMaxLocationCircleSize,((t,e)=>{const o=e,n=new i.DW(Object.assign(Object.assign({},t),{width:t.width+2*o,height:t.height+2*o})).getBounds();return[n[0][0],n[0][1],n[1][0],n[1][1]]})),this.getLocationsForZoom=(0,h.P1)(this.getClusteringEnabled,this.getLocationsHavingFlows,this.getClusterIndex,this.getClusterZoom,((t,e,o,n)=>t&&o?o.getClusterNodesFor(n):e)),this.getLocationTotals=(0,h.P1)(this.getLocationsForZoom,this.getSortedAggregatedFilteredFlows,this.getSelectedLocationsSet,this.getLocationFilterMode,((t,e,o,n)=>{if(!e)return;const i=new Map,s=(t,e)=>{var o;const n=null!==(o=i.get(t))&&void 0!==o?o:{incomingCount:0,outgoingCount:0,internalCount:0};return null!=e.incomingCount&&(n.incomingCount+=e.incomingCount),null!=e.outgoingCount&&(n.outgoingCount+=e.outgoingCount),null!=e.internalCount&&(n.internalCount+=e.internalCount),n};for(const r of e)if(this.isFlowInSelection(r,o,n)){const t=this.accessors.getFlowOriginId(r),e=this.accessors.getFlowDestId(r),o=this.accessors.getFlowMagnitude(r);t===e?i.set(t,s(t,{internalCount:o})):(i.set(t,s(t,{outgoingCount:o})),i.set(e,s(e,{incomingCount:o})))}return i})),this.getLocationsTree=(0,h.P1)(this.getLocationsForZoom,(t=>{if(t)return new d.Z(t,(t=>Kt(P(t)?t.centroid[0]:this.accessors.getLocationCentroid(t)[0])),(t=>$t(P(t)?t.centroid[1]:this.accessors.getLocationCentroid(t)[1])))})),this._getLocationIdsInViewport=(0,h.P1)(this.getLocationsTree,this.getViewportBoundingBox,((t,e)=>{const o=this._getLocationsInBboxIndices(t,e);if(o)return new Set(o.map((e=>t.points[e].id)))})),this.getLocationIdsInViewport=(0,h.wN)(f.PW,((t,e,o)=>{if(t===e)return!0;if(null==t||null==e)return!1;if(t.size!==e.size)return!1;for(const n of t)if(!e.has(n))return!1;return!0}))(this._getLocationIdsInViewport,(t=>{if(t)return t})),this.getTotalUnfilteredCount=(0,h.P1)(this.getSortedFlowsForKnownLocations,(t=>{if(t)return t.reduce(((t,e)=>t+this.accessors.getFlowMagnitude(e)),0)})),this.getTotalFilteredCount=(0,h.P1)(this.getSortedAggregatedFilteredFlows,this.getSelectedLocationsSet,this.getLocationFilterMode,((t,e,o)=>{if(!t)return;return t.reduce(((t,n)=>this.isFlowInSelection(n,e,o)?t+this.accessors.getFlowMagnitude(n):t),0)})),this._getLocationTotalsExtent=(0,h.P1)(this.getLocationTotals,(t=>Ht(t,void 0))),this._getLocationTotalsForViewportExtent=(0,h.P1)(this.getLocationTotals,this.getLocationIdsInViewport,((t,e)=>Ht(t,e))),this.getLocationTotalsExtent=(t,e)=>t.settingsState.adaptiveScalesEnabled?this._getLocationTotalsForViewportExtent(t,e):this._getLocationTotalsExtent(t,e),this.getFlowsForFlowmapLayer=(0,h.P1)(this.getSortedAggregatedFilteredFlows,this.getLocationIdsInViewport,this.getSelectedLocationsSet,this.getLocationFilterMode,this.getMaxTopFlowsDisplayNum,((t,e,o,n,i)=>{if(!t||!e)return;const s=[];let r=0;for(const a of t){const t=this.accessors.getFlowOriginId(a),c=this.accessors.getFlowDestId(a);if((e.has(t)||e.has(c))&&this.isFlowInSelection(a,o,n)&&t!==c&&(s.push(a),r++),r>i)break}return s.reverse()})),this._getFlowMagnitudeExtent=(t,e)=>{if(!t.settingsState.adaptiveScalesEnabled)return this.getFlowMagnitudeExtent(t,e);{const o=this.getFlowsForFlowmapLayer(t,e);if(o){const t=(0,a.Z)(o,this.accessors.getFlowMagnitude);return void 0!==t[0]&&void 0!==t[1]?t:void 0}}},this.getLocationMaxAbsTotalGetter=(0,h.P1)(this.getLocationTotals,(t=>e=>{const o=null===t||void 0===t?void 0:t.get(e);if(o)return Math.max(Math.abs(o.incomingCount+o.internalCount),Math.abs(o.outgoingCount+o.internalCount))})),this.getFlowThicknessScale=(0,h.P1)(this.getFlowMagnitudeExtent,(t=>{if(t)return(0,g.Z)().range([.025,.5]).domain([0,Math.max.apply(null,t.map((t=>Math.abs(t||0))))])})),this.getCircleSizeScale=(0,h.P1)(this.getMaxLocationCircleSize,this.getLocationTotalsEnabled,this.getLocationTotalsExtent,((t,e,o)=>e?o?(0,u._b)().range([0,t]).domain([0,Math.max.apply(null,o.map((t=>Math.abs(t||0))))]):void 0:()=>t)),this.getInCircleSizeGetter=(0,h.P1)(this.getCircleSizeScale,this.getLocationTotals,((t,e)=>o=>{const n=null===e||void 0===e?void 0:e.get(o);return n&&t&&t(Math.abs(n.incomingCount+n.internalCount))||0})),this.getOutCircleSizeGetter=(0,h.P1)(this.getCircleSizeScale,this.getLocationTotals,((t,e)=>o=>{const n=null===e||void 0===e?void 0:e.get(o);return n&&t&&t(Math.abs(n.outgoingCount+n.internalCount))||0})),this.getSortedLocationsForZoom=(0,h.P1)(this.getLocationsForZoom,this.getInCircleSizeGetter,this.getOutCircleSizeGetter,((t,e,o)=>{if(!t)return;return[...t].sort(((t,n)=>{const i=this.accessors.getLocationId(t),s=this.accessors.getLocationId(n);return(0,c.Z)(Math.max(e(i),o(i)),Math.max(e(s),o(s)))}))})),this.getLocationsForFlowmapLayer=(0,h.P1)(this.getSortedLocationsForZoom,(t=>t)),this.getLocationsForFlowmapLayerById=(0,h.P1)(this.getLocationsForFlowmapLayer,(t=>{if(t)return t.reduce(((t,e)=>(t.set(this.accessors.getLocationId(e),e),t)),new Map)})),this.getLayersData=(0,h.P1)(this.getLocationsForFlowmapLayer,this.getFlowsForFlowmapLayer,this.getFlowmapColorsRGBA,this.getLocationsForFlowmapLayerById,this.getLocationIdsInViewport,this.getInCircleSizeGetter,this.getOutCircleSizeGetter,this.getFlowThicknessScale,this.getAnimate,((t,e,o,n,i,s,r,a,c)=>this._prepareLayersData(t,e,o,n,i,s,r,a,c))),this.accessors=new Pt(t),this.setAccessors(t)}setAccessors(t){this.accessors=new Pt(t)}prepareLayersData(t,e){const o=this.getLocationsForFlowmapLayer(t,e)||[],n=this.getFlowsForFlowmapLayer(t,e)||[],i=this.getFlowmapColorsRGBA(t,e),s=this.getLocationsForFlowmapLayerById(t,e),r=this.getLocationIdsInViewport(t,e),a=this.getInCircleSizeGetter(t,e),c=this.getOutCircleSizeGetter(t,e),l=this.getFlowThicknessScale(t,e);return this._prepareLayersData(o,n,i,s,r,a,c,l,t.settingsState.animationEnabled)}_prepareLayersData(t,e,o,n,i,s,r,c,l){t||(t=[]),e||(e=[]);const{getFlowOriginId:g,getFlowDestId:u,getFlowMagnitude:d,getLocationId:h,getLocationCentroid:f}=this.accessors,w=t=>{const e=null===n||void 0===n?void 0:n.get(t);return e?f(e):[0,0]},p=function(t,e,o){const n=e?e[0]:0,i=e?e[1]:0;if(yt(t)){const e=bt([0,i],t.positive.flows.scheme,o),s=bt([0,n],t.negative.flows.scheme,o);return t=>t>=0?e(t):s(t)}const s=bt([0,i||0],t.flows.scheme,o);return t=>s(t)}(o,(0,a.Z)(e,(t=>d(t))),!1),F=Float32Array.from(function*(){for(const e of t)yield*f(e)}()),v=yt(o)?o.positive.locationCircles.inner:o.locationCircles.inner,L=Uint8Array.from(function*(){for(const e of t)yield*v}()),I=Float32Array.from(function*(){for(const e of t){const t=h(e);yield(null===i||void 0===i?void 0:i.has(t))?s(t):1}}()),b=Float32Array.from(function*(){for(const e of t){const t=h(e);yield(null===i||void 0===i?void 0:i.has(t))?r(t):1}}()),y=Float32Array.from(function*(){for(const t of e)yield*w(g(t))}()),S=Float32Array.from(function*(){for(const t of e)yield*w(u(t))}()),C=Float32Array.from(function*(){for(const t of e)yield c&&c(d(t))||0}()),M=Float32Array.from(function*(){for(const t of e){const e=g(t),o=u(t);yield Math.max(s(e),r(e)),yield Math.max(s(o),r(o))}}()),x=Uint8Array.from(function*(){for(const t of e)yield*p(d(t))}()),P=l?Float32Array.from(function*(){for(const t of e)yield new m.alea("".concat(g(t),"-").concat(u(t)))()}()):void 0;return{circleAttributes:{length:t.length,attributes:{getPosition:{value:F,size:2},getColor:{value:L,size:4},getInRadius:{value:I,size:1},getOutRadius:{value:b,size:1}}},lineAttributes:{length:e.length,attributes:Object.assign({getSourcePosition:{value:y,size:2},getTargetPosition:{value:S,size:2},getThickness:{value:C,size:1},getColor:{value:x,size:4},getEndpointOffsets:{value:M,size:2}},P?{getStaggering:{value:P,size:1}}:{})}}}getLocationsInBbox(t,e){if(t)return this._getLocationsInBboxIndices(t,e).map((e=>t.points[e]))}_getLocationsInBboxIndices(t,e){if(!t)return;const[o,n,i,s]=e,[r,a,c,l]=[Kt(o),$t(n),Kt(i),$t(s)];return t.range(Math.min(r,c),Math.min(a,l),Math.max(r,c),Math.max(a,l))}isFlowInSelection(t,e,o){const n=this.accessors.getFlowOriginId(t),i=this.accessors.getFlowDestId(t);if(e)switch(o){case T.ALL:return e.has(n)||e.has(i);case T.BETWEEN:return e.has(n)&&e.has(i);case T.INCOMING:return e.has(i);case T.OUTGOING:return e.has(n)}return!0}}function Ht(t,e){if(!t)return;let o;for(const[n,{incomingCount:i,outgoingCount:s,internalCount:r}]of t.entries())if(null==e||e.has(n)){const t=Math.min(i+r,s+r,r),e=Math.max(i+r,s+r,r);o?(t<o[0]&&(o[0]=t),e>o[1]&&(o[1]=e)):o=[t,e]}return o}function Kt(t){return t/360+.5}function $t(t){const e=Math.sin(t*Math.PI/180),o=.5-.25*Math.log((1+e)/(1-e))/Math.PI;return o<0?0:o>1?1:o}var Wt=o(2208);function Jt(t,e,o,n){return function(t,e,o){const{pad:n=.05,maxZoom:s=100}=o||{},r=(0,Wt.Z)(t),[[a,c],[l,g]]=r,u=n?[[a-n*(l-a),c-n*(g-c)],[l+n*(l-a),g+n*(g-c)]]:r,[d,h]=e;return Object.assign(Object.assign({},(0,i.Xg)({width:d,height:h,bounds:u,padding:null===o||void 0===o?void 0:o.padding,maxZoom:s})),{width:d,height:h})}({type:"GeometryCollection",geometries:t.map((t=>({type:"Point",coordinates:e(t)})))},o,n)}var Xt=function(t,e,o,n){return new(o||(o=Promise))((function(i,s){function r(t){try{c(n.next(t))}catch(e){s(e)}}function a(t){try{c(n.throw(t))}catch(e){s(e)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof o?e:new o((function(t){t(e)}))).then(r,a)}c((n=n.apply(t,e||[])).next())}))};class qt{constructor(t){this.selectors=new Ut(t),this.flowmapData=void 0,this.flowmapState=void 0}setAccessors(t){this.selectors.setAccessors(t)}setFlowmapData(t){return Xt(this,void 0,void 0,(function*(){this.flowmapData=t}))}setFlowmapState(t){return Xt(this,void 0,void 0,(function*(){this.flowmapState=t}))}getFlowByIndex(t){return Xt(this,void 0,void 0,(function*(){if(!this.flowmapState||!this.flowmapData)return;const e=this.selectors.getFlowsForFlowmapLayer(this.flowmapState,this.flowmapData);return null===e||void 0===e?void 0:e[t]}))}getLocationByIndex(t){return Xt(this,void 0,void 0,(function*(){if(!this.flowmapState||!this.flowmapData)return;const e=this.selectors.getLocationsForFlowmapLayer(this.flowmapState,this.flowmapData);return null===e||void 0===e?void 0:e[t]}))}getLayersData(){return Xt(this,void 0,void 0,(function*(){if(this.flowmapState&&this.flowmapData)return this.selectors.getLayersData(this.flowmapState,this.flowmapData)}))}getLocationById(t){return Xt(this,void 0,void 0,(function*(){if(!this.flowmapState||!this.flowmapData)return;const e=this.selectors.getClusterIndex(this.flowmapState,this.flowmapData);if(e){const o=e.getClusterById(t);if(o)return o}const o=this.selectors.getLocationsById(this.flowmapState,this.flowmapData);return null===o||void 0===o?void 0:o.get(t)}))}getTotalsForLocation(t){var e;return Xt(this,void 0,void 0,(function*(){if(this.flowmapState&&this.flowmapData)return null===(e=this.selectors.getLocationTotals(this.flowmapState,this.flowmapData))||void 0===e?void 0:e.get(t)}))}getViewportForLocations(t,e){var o;return Xt(this,void 0,void 0,(function*(){if(null===(o=this.flowmapData)||void 0===o?void 0:o.locations)return Jt(this.flowmapData.locations,this.selectors.accessors.getLocationCentroid,t,e)}))}}var Qt=o(7745),te=o(7340),ee=function(t,e,o,n){return new(o||(o=Promise))((function(i,s){function r(t){try{c(n.next(t))}catch(e){s(e)}}function a(t){try{c(n.throw(t))}catch(e){s(e)}}function c(t){var e;t.done?i(t.value):(e=t.value,e instanceof o?e:new o((function(t){t(e)}))).then(r,a)}c((n=n.apply(t,e||[])).next())}))};const oe=[te.w];(0,n.Jj)(class{constructor(t){this.props=t,this.localProvider=new qt({getFlowOriginId:e=>e[t.flows.columns.originId],getFlowDestId:e=>e[t.flows.columns.destId],getFlowMagnitude:e=>e[t.flows.columns.count],getLocationCentroid:e=>[e[t.locations.columns.lon],e[t.locations.columns.lat]],getLocationName:e=>e[t.locations.columns.name],getLocationId:e=>e[t.locations.columns.id]}),this.flowmapState=void 0}loadData(){return ee(this,void 0,void 0,(function*(){const[t,e]=yield Promise.all([(0,Qt.z)(this.props.locations.url,oe),(0,Qt.z)(this.props.flows.url,oe)]);yield this.localProvider.setFlowmapData({locations:t,flows:e})}))}setAccessors(t){throw new Error("Not supported")}setFlowmapData(t){return ee(this,void 0,void 0,(function*(){throw new Error("Not supported")}))}setFlowmapState(t){return ee(this,void 0,void 0,(function*(){yield this.localProvider.setFlowmapState(t)}))}getFlowByIndex(t){return ee(this,void 0,void 0,(function*(){return this.localProvider.getFlowByIndex(t)}))}getLocationByIndex(t){return ee(this,void 0,void 0,(function*(){return this.localProvider.getLocationByIndex(t)}))}getLayersData(){return ee(this,void 0,void 0,(function*(){return yield this.localProvider.getLayersData()}))}getLocationById(t){return ee(this,void 0,void 0,(function*(){return this.localProvider.getLocationById(t)}))}getTotalsForLocation(t){return ee(this,void 0,void 0,(function*(){return this.localProvider.getTotalsForLocation(t)}))}getViewportForLocations(t){return this.localProvider.getViewportForLocations(t)}})},5108:function(){},8515:function(){},660:function(){}},e={};function o(n){var i=e[n];if(void 0!==i)return i.exports;var s=e[n]={id:n,loaded:!1,exports:{}};return t[n].call(s.exports,s,s.exports,o),s.loaded=!0,s.exports}o.m=t,o.x=function(){var t=o.O(void 0,[65],(function(){return o(6445)}));return t=o.O(t)},o.amdD=function(){throw new Error("define cannot be used indirect")},o.amdO={},function(){var t=[];o.O=function(e,n,i,s){if(!n){var r=1/0;for(g=0;g<t.length;g++){n=t[g][0],i=t[g][1],s=t[g][2];for(var a=!0,c=0;c<n.length;c++)(!1&s||r>=s)&&Object.keys(o.O).every((function(t){return o.O[t](n[c])}))?n.splice(c--,1):(a=!1,s<r&&(r=s));if(a){t.splice(g--,1);var l=i();void 0!==l&&(e=l)}}return e}s=s||0;for(var g=t.length;g>0&&t[g-1][2]>s;g--)t[g]=t[g-1];t[g]=[n,i,s]}}(),o.d=function(t,e){for(var n in e)o.o(e,n)&&!o.o(t,n)&&Object.defineProperty(t,n,{enumerable:!0,get:e[n]})},o.f={},o.e=function(t){return Promise.all(Object.keys(o.f).reduce((function(e,n){return o.f[n](t,e),e}),[]))},o.u=function(t){return"static/js/"+t+".ba1f78bd.chunk.js"},o.miniCssF=function(t){},o.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}(),o.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},o.nmd=function(t){return t.paths=[],t.children||(t.children=[]),t},o.p="/flowmap.gl/",function(){var t={735:1};o.f.i=function(e,n){t[e]||importScripts(o.p+o.u(e))};var e=self.webpackChunk_flowmap_gl_react_app_example=self.webpackChunk_flowmap_gl_react_app_example||[],n=e.push.bind(e);e.push=function(e){var i=e[0],s=e[1],r=e[2];for(var a in s)o.o(s,a)&&(o.m[a]=s[a]);for(r&&r(o);i.length;)t[i.pop()]=1;n(e)}}(),function(){var t=o.x;o.x=function(){return o.e(65).then(t)}}();o.x()}();
//# sourceMappingURL=735.50145261.chunk.js.map